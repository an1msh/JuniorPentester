# Check if a root domain was provided as an argument
if [ $# -eq 0 ]; then
  echo "Error: No root domain provided"
  exit 1
fi

# Set the default number of threads to 10
num_threads=10

# Parse the command-line arguments
while getopts ":T:" opt; do
  case $opt in
    T)
      num_threads=$OPTARG
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      exit 1
      ;;
  esac
done

# Shift the parsed options to the right to get the root domain argument
shift $((OPTIND-1))
root_domain=$1

# Find all the subdomains and assets for the root domain
echo "Finding subdomains and assets for $root_domain..."
subfinder -d $root_domain -o subdomains-$root_domain.txt
assetfinder --subs-only $root_domain >> subdomains-$root_domain.txt

# Find subdomains using crt.sh
echo "Finding subdomains using crt.sh..."
curl -s "https://crt.sh/?q=%.$root_domain&output=json" | jq -r '.[].name_value' | sed 's/\*\.//g' >> subdomains-$root_domain.txt

# Remove duplicate subdomains
echo "Removing duplicate subdomains..."
sort -u subdomains-$root_domain.txt -o subdomains-$root_domain.txt

# Generate further subdomains using altdns
echo "Generating additional subdomains using altdns..."
python3 altdns/altdns.py -i subdomains-$root_domain.txt -o altdns_output-$root_domain.txt -w altdns/words.txt

# Check which subdomains resolve using the specified number of threads
echo "Checking which subdomains resolve..."
cat altdns_output-$root_domain.txt | xargs -P $num_threads -I % bash -c 'if host % &>/dev/null; then echo % >> resolved-$root_domain.txt; fi'

echo "Done!"
